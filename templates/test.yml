parameters:
  configuration: ""
  framework: ""
  platform: ""

steps:
  - task: DotNetCoreCLI@2
    displayName: Test ${{ parameters.framework }}
    inputs:
      command: test
      projects: "test/**/*.csproj"
      arguments: "--configuration ${{ parameters.configuration }} --framework ${{ parameters.framework }} --no-build --results-directory $(Build.SourcesDirectory)/TestResults/${{ parameters.framework }} --logger trx /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:CoverletOutput=$(Build.SourcesDirectory)/TestResults/${{ parameters.framework }}/coverage"
      publishTestResults: false

  - task: PublishTestResults@2
    displayName: Publish ${{ parameters.framework }} test results
    inputs:
      testResultsFormat: NUnit
      testResultsFiles: $(Build.SourcesDirectory)/TestResults/${{ parameters.framework }}/*.xml
      mergeTestResults: true
      testRunTitle: ${{ parameters.framework }}/${{ parameters.platform }}

  - task: PublishCodeCoverageResults@1
    displayName: Publish ${{ parameters.framework }} coverage results
    inputs:
      codeCoverageTool: "cobertura"
      summaryFileLocation: "$(Build.SourcesDirectory)/TestResults/${{ parameters.framework }}/coverage.xml"
